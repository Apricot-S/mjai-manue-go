# Original-vs-Port Testing Framework

A test framework for comparing and verifying the behavior of mjai-manue's original implementation and the Go port.

## gen_log

Docker Compose configuration and related scripts for generating game logs. It runs one instance of the original mjai-manue against three existing mjai clients ([Akochan](https://github.com/critter-mj/akochan)) on the mjai platform, playing games and generating game logs.

### Services

- server  
  - The mjai server.
  - Manages game progression and outputs logs to `../log_dir` (output directory can be changed).
- manue  
  - The original mjai-manue (1 instance).
  - Connects to the server to play matches.
- akochan1 / akochan2 / akochan3  
  - Existing mjai clients (3 instances) used as opponents.
  - Connect to the server to play matches.

### Log Output

- After each game, the server outputs a game log in mjson (JSON Lines) format.
- Logs are saved under `gen_log/../log_dir/` (output directory can be changed).
- Filenames are timestamp-based (e.g., `2025-08-14-163231.mjson`).

### Usage

With `test/original_vs_port/gen_log/` as the current directory, run the following command:

```sh
NUM_GAMES=<NUMBER_OF_GAMES> docker compose up
```

Specify the number of games to run in `NUM_GAMES` (default is 1).

## verify

A Go program that reads game logs generated by `gen_log` and checks for differences in decision-making between the original mjai-manue and the port. Reads specified logs in mjson format and compares their actions at each decision-making point. When differences are found, outputs a report showing the state and chosen action.

### Input

- mjson format game logs that contain **exactly one** player of the original mjai-manue.
- The original mjai-manue is identified by the player name `Manue014`.
- Intended to use files generated by `gen_log`, but any game log meeting this condition can be used.

### Output

Outputs the differences as a report (text format) to standard output.

### Usage

With the top-level directory of working tree of this repository as the current directory, run the following command:

```sh
go run ./test/original_vs_port/verify <LOG_GLOB_PATTERNS>... > <OUTPUT_FILEPATH>
```

- `<LOG_GLOB_PATTERNS>`  
  Log file patterns to compare (e.g., `./test/original_vs_port/log_dir/*.mjson`).
