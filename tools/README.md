# Tools to generate stats and decision trees from game records

(TODO)

## dump_game_stats

This tool analyzes game logs in mjai format, including gzip-compressed files, and generates overall game statistics such as number of wins, tsumo rate, draw ratio, average winning points, and tenpai timing distributions.

### What It Does

(TODO)

### Output

The tool writes the resulting statistics as JSON to standard output.
You can redirect or pipe it as needed for downstream processing.

The output is directly usable as `configs/game_stats.json`.

### Usage

With the top-level directory of working tree of this repository as the current directory, run the following command:

```sh
go run ./tools/dump_game_stats <log_glob_patterns...> > <game_stats.json>
```

- Replace `<log_glob_patterns...>` with one or more file path patterns matching your target logs, such as `"logs/*/*.mjson"` and `"logs/*/*.mjson.gz"`. You can specify multiple patterns, separated by spaces.
- Output is written to `<game_stats.json>` in JSON format.

#### Sample Output (formatted)

```json
{
  "numHoras": 17793,
  "numTsumoHoras": 7195,
  "numTurnsDistribution": [
    0.008629732049203776,
    ...
  ],
  "ryukyokuRatio": 0.15700390960236482,
  "averageHoraPoints": 5533.648063845332,
  "koHoraPointsFreqs": {
    "1000": 1087,
    "1100": 445,
    ...
    "32000": 1,
    "total": 12834
  },
  "oyaHoraPointsFreqs": {
    "1500": 555,
    "2000": 154,
    ...
    "36000": 1,
    "total": 4959
  },
  "yamitenStats": {
    "17,0": {
      "total": 41903,
      "tenpai": 2
    },
    ...
    "12,4": {
      "total": 4,
      "tenpai": 4
    }
  },
  "ryukyokuTenpaiStat": {
    "total": 13172,
    "tenpai": 5468,
    "noten": 7704,
    "tenpaiTurnDistribution": {
      "0": 0,
      ...
      "17.5": 46,
    }
  }
}
```

## dump_light_game_stats

This tool analyzes game logs in mjai format, including gzip-compressed files, and generates per-round statistics on score differentials.

### What It Does

- Processes each game log and examines every round
- For each player, calculates the score difference between their starting and ending points
- Groups results by the player's seating position relative to the starting dealer (chicha)
- Aggregates and outputs the frequency of each differential

### Output

The tool writes the resulting statistics as JSON to standard output.
You can redirect or pipe it as needed for downstream processing.

> [!IMPORTANT]
> The output from this tool **cannot** be used directly as `configs/light_game_stats.json`.
> You must run it through `postprocess_light_game_stats` to convert it into the proper format.

### Usage

With the top-level directory of working tree of this repository as the current directory, run the following command:

```sh
go run ./tools/dump_light_game_stats <log_glob_patterns...> > <score_stats.json>
```

- Replace `<log_glob_patterns...>` with one or more file path patterns matching your target logs, such as `"logs/*/*.mjson"` and `"logs/*/*.mjson.gz"`. You can specify multiple patterns, separated by spaces.
- Output is written to `<score_stats.json>` in JSON format.

#### Sample Output (formatted)

```json
{
  "scoreStats": {
    "E1,0": {
      "0": 12,
      "1000": 5,
      ...
      "-8000": 3
      ...
    },
    "E1,1": {
      ...
    },
    ...
  }
}
```

## postprocess_light_game_stats

This tool transforms score differentials generated by `dump_light_game_stats` into win probabilities.

### What It Does

- Loads a score differential map generated by `dump_light_game_stats`
- Computes score ratio distributions for each player in each round
- Calculates relative score distributions between every pair of seat positions
- Derives and outputs cumulative win probabilities for player-vs-player comparisons

### Output

The tool writes the resulting win probabilities as JSON to standard output.
You can redirect or pipe it as needed for downstream processing.

The output is directly usable as `configs/light_game_stats.json`.

### Usage

With the top-level directory of working tree of this repository as the current directory, run the following command:

```sh
go run ./tools/postprocess_light_game_stats <score_stats.json> > <light_game_stats.json>
```

- `<score_stats.json>` must contain the raw output from `dump_light_game_stats`.
- Output is written to `<light_game_stats.json>` in JSON format.

#### Sample Output (formatted)

```json
{
  "winProbsMap": {
    "E1,0,1": {
      ...
      "-100": 0.4201448961937716,
      "-1000": 0.40051903114186843,
      ...
    },
    "E1,0,2": {
      ...
    },
    ...
  }
}
```
